å›åˆ°pandasçš„åŠŸèƒ½

## ğŸ“Œ æ»šåŠ¨çª—å£è®¡ç®—

### ğŸš rolling

series.rolling(window=5): åˆ›å»ºçª—å£å¤§å°ä¸º5çš„æ»šåŠ¨çª—å£å¯¹è±¡ï¼Œå¹¶æ­é…ç»Ÿè®¡æ–¹æ³•è¿›è¡Œè®¡ç®—ã€‚

ç»Ÿè®¡è®¡ç®—æ–¹æ³•ä¸€è§ˆ: 

- mean(): è®¡ç®—æ»šåŠ¨çª—å£çš„å‡å€¼ã€‚
- std(): è®¡ç®—æ»šåŠ¨çª—å£çš„æ ‡å‡†å·®ã€‚
- sum(): è®¡ç®—æ»šåŠ¨çª—å£çš„æ€»å’Œã€‚
- min(): è®¡ç®—æ»šåŠ¨çª—å£çš„æœ€å°å€¼ã€‚
- max(): è®¡ç®—æ»šåŠ¨çª—å£çš„æœ€å¤§å€¼ã€‚
- median(): è®¡ç®—æ»šåŠ¨çª—å£çš„ä¸­ä½æ•°ã€‚
- quantile(q): è®¡ç®—æ»šåŠ¨çª—å£çš„åˆ†ä½æ•°ã€‚
- apply(func, raw=False, args=(), kwargs={}): åº”ç”¨è‡ªå®šä¹‰å‡½æ•°ã€‚
- agg(func, *args, **kwargs): åº”ç”¨å¤šä¸ªèšåˆå‡½æ•°

```python
import pandas as pd
import numpy as np

# åˆ›å»ºdataframeï¼Œä»2023-01-01å¼€å§‹ï¼Œç”Ÿæˆ100ä¸ªæ—¥æœŸï¼Œé¢‘ç‡ä¸ºæ¯å¤©
dates = pd.date_range('2023-01-01', periods=100, freq='D')
# ä½¿ç”¨ç´¯ç§¯å’Œï¼Œç”Ÿæˆä¸€ä¸ªå…·æœ‰è¶‹åŠ¿æ€§çš„æ—¶é—´åºåˆ—ï¼Œç±»ä¼¼äºè‚¡ç¥¨ä»·æ ¼çš„é•¿æœŸè¶‹åŠ¿ã€‚
data = np.random.randn(100).cumsum()
# åˆ›å»ºDataFrameï¼Œæ—¥æœŸä½œä¸ºç´¢å¼•ï¼Œè‚¡ä»·ä½œä¸ºåˆ—
df = pd.DataFrame(data, index=dates, columns=['Value'])

# è®¡ç®—5æ—¥ç§»åŠ¨å¹³å‡ (MA5)
# rolling(window=5): åˆ›å»ºçª—å£å¤§å°ä¸º5çš„æ»šåŠ¨çª—å£å¯¹è±¡
# mean(): è®¡ç®—æ¯ä¸ªæ—¶é—´ç‚¹å‰5ä¸ªæ•°æ®ç‚¹çš„å‡å€¼ã€‚
ma5 = df['Value'].rolling(window=5).mean()

# åŒç†å¾—ma20
ma20 = df['Value'].rolling(window=20).mean()

# åŸºäºma20è®¡ç®—å¸ƒæ—å¸¦
# è®¡ç®—20æ—¥æ ‡å‡†å·®
std_20 = df['Value'].rolling(window=20).std()

# è®¾å®šå¸ƒæ—å¸¦çš„å€æ•°å› å­ï¼Œé»˜è®¤ä¸º2
k = 2

# æ ¹æ®å…¬å¼ï¼Œè®¡ç®—å¸ƒæ—å¸¦ä¸Šè½¨ (UB) å’Œä¸‹è½¨ (LB)
upper_band = ma20 + k * std_20
lower_band = ma20 - k * std_20

# å°†å¸ƒæ—å¸¦æ·»åŠ åˆ°DataFrameä¸­
df['MA20'] = ma20
df['Upper_Band'] = upper_band
df['Lower_Band'] = lower_band

# æ‰“å°æˆ–ç»˜åˆ¶ç»“æœ
print(df.tail())

```

### ğŸš expanding

ç”¨äºè®¡ç®—æ»šåŠ¨çª—å£çš„ç´¯ç§¯ç»Ÿè®¡é‡ã€‚

ä¸`rolling`ä¸åŒï¼Œ`expanding`çª—å£å¤§å°ä¼šéšç€æ•°æ®ç‚¹çš„å¢åŠ è€Œé€æ¸æ‰©å¤§ï¼Œå³ä»èµ·å§‹ç‚¹åˆ°å½“å‰ç‚¹çš„æ‰€æœ‰æ•°æ®ã€‚

å¸¸ç”¨æ–¹æ³•: 

- mean(): è®¡ç®—ç´¯ç§¯å‡å€¼ã€‚
- sum(): è®¡ç®—ç´¯ç§¯æ€»å’Œã€‚
- std(): è®¡ç®—ç´¯ç§¯æ ‡å‡†å·®ã€‚
- var(): è®¡ç®—ç´¯ç§¯æ–¹å·®ã€‚
- median(): è®¡ç®—ç´¯ç§¯ä¸­ä½æ•°ã€‚
- min(): è®¡ç®—ç´¯ç§¯æœ€å°å€¼ã€‚
- max(): è®¡ç®—ç´¯ç§¯æœ€å¤§å€¼ã€‚
- apply(func): åº”ç”¨è‡ªå®šä¹‰å‡½æ•°ã€‚

```python
import pandas as pd
import numpy as np

# åˆ›å»ºdataframeï¼Œä»2023-01-01å¼€å§‹ï¼Œç”Ÿæˆ100ä¸ªæ—¥æœŸï¼Œé¢‘ç‡ä¸ºæ¯å¤©
dates = pd.date_range('2023-01-01', periods=100, freq='D')
# ä½¿ç”¨ç´¯ç§¯å’Œï¼Œç”Ÿæˆä¸€ä¸ªå…·æœ‰è¶‹åŠ¿æ€§çš„æ—¶é—´åºåˆ—ï¼Œç±»ä¼¼äºè‚¡ç¥¨ä»·æ ¼ï¼ˆæ”¶ç›˜ä»·ï¼‰çš„é•¿æœŸè¶‹åŠ¿ã€‚
data = np.random.randn(100).cumsum()
df = pd.DataFrame(data, index=dates, columns=['Value'])

# è®¡ç®—æ¯æ—¥å›æŠ¥ç‡
df['Return'] = df['Value'].pct_change()

# ä½¿ç”¨ expanding å’Œ apply è®¡ç®—ç´¯ç§¯å›æŠ¥ç‡
df['Cumulative_Return'] = df['Return'].add(1).expanding().apply(np.prod) - 1

print(df.tail())
```