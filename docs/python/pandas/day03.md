ç»­day02ï¼Œç»§ç»­numpyçš„å†…å®¹ã€‚

## ğŸ“Œ çº¿æ€§ä»£æ•°

### ğŸš çŸ©é˜µä¹˜æ³•

`np.dot`: ä¸»è¦ç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°ç»„çš„ç‚¹ç§¯ã€‚å¯¹äºäºŒç»´æ•°ç»„ï¼Œnp.dot ç­‰ä»·äºçŸ©é˜µä¹˜æ³•ã€‚

`np.matmul`: ä¸“é—¨ç”¨äºçŸ©é˜µä¹˜æ³•ï¼Œæ”¯æŒå¤šç»´æ•°ç»„çš„çŸ©é˜µä¹˜æ³•ã€‚

=== "äºŒç»´çŸ©é˜µä¹˜æ³•"

    ```python
    import numpy as np
    
    # 2x2çŸ©é˜µ
    A = np.array([[1, 2], [3, 4]])
    B = np.array([[5, 6], [7, 8]])
    
    D = np.dot(A, B)
    print(D)
    # [[19 22]
    #  [43 50]]

    ```

=== "è¿ç®—è¿‡ç¨‹"

    ![dot_img.png](dot_img.png)

### ğŸš çŸ©é˜µçš„é€†å’Œè¡Œåˆ—å¼

np.linalg.inv(A)  
è®¡ç®—çŸ©é˜µçš„é€†

np.linalg.det(A)  
è®¡ç®—è¡Œåˆ—å¼

### ğŸš è§£çº¿æ€§æ–¹ç¨‹ç»„

ç»™å®šç³»æ•°çŸ©é˜µAå’Œå¸¸æ•°é¡¹bï¼Œæ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„`Ax = b`ã€‚

```python
import numpy as np

# å®šä¹‰çŸ©é˜µAå’Œå‘é‡b
A = np.array([[2, 1], [1, 3]])
b = np.array([9, 8])

# è§£çº¿æ€§æ–¹ç¨‹ç»„
x = np.linalg.solve(A, b)
print("çº¿æ€§æ–¹ç¨‹ç»„çš„è§£:")
print(x)  # [3.8 1.4]
```

### ğŸš åæ–¹å·®çŸ©é˜µ

* æ–¹å·®-æ³¢åŠ¨ç¨‹åº¦ï¼Œæ­£ç›¸å…³ï¼ˆåæ–¹å·®çŸ©é˜µçš„å¯¹è§’çº¿å…ƒç´ ï¼‰ã€‚
* åæ–¹å·®-çŸ©é˜µé—´çš„å…³ç³»ï¼šåæ–¹å·®ä¸ºæ­£æ•°æ—¶ï¼Œè¡¨ç¤ºçŸ©é˜µæ­£ç›¸å…³ï¼›è¶‹è¿‘äº0æ—¶ï¼Œåˆ™è¡¨ç¤ºå‡ ä¹ä¸ç›¸å…³ã€‚
* ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œç”¨äºä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œè¯†åˆ«æ•°æ®çš„ä¸»è¦æˆä»½åŠæ–¹å‘ã€‚

=== "ä»æ”¶ç›Šç‡è®¡ç®—è‚¡ç¥¨é—´çš„å…³ç³»"

    ```python
    import numpy as np
    
    # ä¸‰åªè‚¡ç¥¨çš„æ”¶ç›Šç‡çŸ©é˜µï¼ˆ3è¡Œ1000åˆ—ï¼‰
    stock_returns = np.array([
        np.random.normal(0.0005, 0.02, 1000),
        np.random.normal(0.0003, 0.015, 1000),
        np.random.normal(0.0007, 0.025, 1000)
    ])
    
    # è®¡ç®—åæ–¹å·®çŸ©é˜µ
    # åæ–¹å·®çŸ©é˜µæè¿°äº†ä»¥ä¸Šä¸‰åªè‚¡ç¥¨æ”¶ç›Šç‡ä¹‹é—´çš„ç›¸å…³æ€§ï¼ˆçº¿æ€§å…³ç³»ï¼‰
    cov_matrix = np.cov(stock_returns)
    
    # æå–æ–¹å·®ï¼ˆåæ–¹å·®çŸ©é˜µçš„å¯¹è§’çº¿å…ƒç´ ï¼‰
    # æ–¹å·®-æ³¢åŠ¨ç¨‹åº¦ï¼Œæ­£ç›¸å…³
    variances = np.diag(cov_matrix)
    
    # æå–åæ–¹å·®ï¼ˆåæ–¹å·®çŸ©é˜µçš„éå¯¹è§’çº¿å…ƒç´ ï¼‰
    # åæ–¹å·®-ä¸¤åªè‚¡ç¥¨æ”¶ç›Šç‡é—´çš„å…³ç³»ï¼šåæ–¹å·®ä¸ºæ­£æ•°æ—¶ï¼Œè¡¨ç¤ºä¸¤åªè‚¡ç¥¨æ”¶ç›Šç‡æ­£ç›¸å…³ï¼›è¶‹è¿‘äº0æ—¶ï¼Œåˆ™è¡¨ç¤ºå‡ ä¹ä¸ç›¸å…³
    covariances = cov_matrix - np.diag(np.diag(cov_matrix))
    
    # è®¾ç½®æ‰“å°é€‰é¡¹ï¼ŒæŠ‘åˆ¶ç§‘å­¦è®¡æ•°æ³•ï¼Œè®¾ç½®ä¸ºå°æ•°ç‚¹å6ä½
    np.set_printoptions(suppress=True, precision=6)
    
    print("åæ–¹å·®çŸ©é˜µ:\n", cov_matrix)
    print("æ–¹å·®:\n", variances)
    print("åæ–¹å·®:\n", covariances)
    
    # æå–ç‰¹å®šåæ–¹å·®å€¼
    cov_12 = covariances[0, 1]
    cov_13 = covariances[0, 2]
    cov_23 = covariances[1, 2]
    
    print(f"ç¬¬ä¸€åªè‚¡ç¥¨å’Œç¬¬äºŒåªè‚¡ç¥¨çš„åæ–¹å·®:{cov_12:6f}")
    print(f"ç¬¬ä¸€åªè‚¡ç¥¨å’Œç¬¬ä¸‰åªè‚¡ç¥¨çš„åæ–¹å·®:{cov_13:6f}")
    print(f"ç¬¬äºŒåªè‚¡ç¥¨å’Œç¬¬ä¸‰åªè‚¡ç¥¨çš„åæ–¹å·®:{cov_23:6f}")
    
    # è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œç”¨äºä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰ï¼Œè¯†åˆ«æ•°æ®çš„ä¸»è¦æˆä»½åŠæ–¹å‘ã€‚
    eigenvalues, eigenvectors = np.linalg.eig(cov_matrix)
    
    print("ç‰¹å¾å€¼:\n", eigenvalues)  # ç‰¹å¾å€¼è¶Šå¤§ï¼Œé£é™©ç¨‹åº¦è¶Šé«˜
    print("ç‰¹å¾å‘é‡:\n", eigenvectors)
    
    ```

!!! note "è¡¥å……"

    æ–¹å·®æ˜¯æ¯ä¸ªæ ·æœ¬å€¼ä¸å…¨ä½“æ ·æœ¬å€¼çš„å¹³å‡æ•°ä¹‹å·®çš„å¹³æ–¹å€¼çš„å¹³å‡æ•°ã€‚
    
    æ ‡å‡†å·®åˆ™æ˜¯æ–¹å·®çš„å¹³æ–¹æ ¹ã€‚ç”±äºæ–¹å·®æ˜¯æ•°æ®çš„å¹³æ–¹ï¼Œä¸æ£€æµ‹å€¼æœ¬èº«ç›¸å·®å¤ªå¤§ï¼Œäººä»¬éš¾ä»¥ç›´è§‚çš„è¡¡é‡ï¼Œæ‰€ä»¥å¸¸ç”¨æ–¹å·®å¼€æ ¹å·æ¢ç®—å›æ¥ï¼Œå³æ ‡å‡†å·®ã€‚

## ğŸ“Œ é«˜æ€§èƒ½å‡½æ•°

### ğŸš np.where

å‘é‡åŒ–ç‰ˆæœ¬çš„ä¸‰å…ƒè¡¨è¾¾å¼ï¼Œå…¶åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

`numpy.where(condition[, x, y])`

`condition`å³æ¡ä»¶è¡¨è¾¾å¼ï¼Œå½“è¿”å›Trueæ—¶ï¼Œé€‰æ‹©`x`ï¼Œå¦åˆ™é€‰æ‹©`y`ã€‚

```python
import numpy as np

tmp = np.array([1, -2, 3, 4, -5, 6, 7, 8, 9, 10])
_ = np.where(tmp < 0, 0, tmp)
print(_)  # [ 1  0  3  4  0  6  7  8  9 10]

```

### ğŸš np.select

æ ¹æ®å¤šä¸ªæ¡ä»¶é€‰æ‹©å…ƒç´ ï¼Œé€‚ç”¨äºéœ€è¦æ ¹æ®å¤šä¸ªæ¡ä»¶è¿›è¡Œé€‰æ‹©çš„æƒ…å†µã€‚å…¶åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š

`numpy.select(condlist, choicelist, default=0)`

`condlist`æ˜¯æ¡ä»¶è¡¨è¾¾å¼åˆ—è¡¨ï¼Œè¿”å›Trueæ—¶ä»`choicelist`æ•°ç»„åˆ—è¡¨ä¸­å–å¯¹åº”å€¼ã€‚

è¦æ±‚: æ‰€æœ‰æ¡ä»¶æ•°ç»„å¿…é¡»å…·æœ‰ç›¸åŒçš„å½¢çŠ¶æˆ–èƒ½å¤Ÿå¹¿æ’­åˆ°ç›¸åŒçš„å½¢çŠ¶ã€‚

=== "ç¤ºä¾‹"

    ```python
    import numpy as np
    
    arr = np.array([1, -2, 3, 4, -5, 6, 7, 8, 9, 10])
    print("å•æ¡ä»¶:", arr[arr > 0])  # [ 1  3  4  6  7  8  9 10]
    
    # å®šä¹‰å¤šä¸ªæ¡ä»¶å’Œå¯¹åº”çš„é€‰æ‹©
    conditions = [arr < 3, arr > 7]
    choices = [0, 99]
    
    # éå†æ•°ç»„arrï¼Œå°äº3æ—¶å–choices[0]ï¼Œå¤§äº7æ—¶å–choices[1]ï¼Œå…¶ä»–æƒ…å†µä¿æŒä¸å˜
    arr_modified = np.select(conditions, choices, default=arr)
    print("ä¿®æ”¹åçš„æ•°ç»„:", arr_modified)  # [ 0  0  3  4  0  6  7 99 99 99]
    
    ```

=== "select+å¹¿æ’­"

    ```python
    import numpy as np
    
    # åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç»„
    arr = np.random.randint(0, 10, size=(3, 4))
    print("åŸå§‹æ•°ç»„:\n", arr)
    
    # å®šä¹‰å¤šä¸ªæ¡ä»¶å’Œå¯¹åº”çš„é€‰æ‹©
    conditions = [arr < 3, arr > 7]
    
    # å®šä¹‰é€‰æ‹©çš„å€¼ï¼Œå…·æœ‰ä¸åŒçš„å½¢çŠ¶
    choices = [
        np.zeros((3, 1)),  # å½“æ¡ä»¶1ä¸ºçœŸæ—¶é€‰æ‹© 0ï¼Œå½¢çŠ¶ä¸º (3, 1)
        np.full((1, 4), 99)  # å½“æ¡ä»¶2ä¸ºçœŸæ—¶é€‰æ‹© 99ï¼Œå½¢çŠ¶ä¸º (1, 4)
    ]
    
    # ä½¿ç”¨ np.select è¿›è¡Œé€‰æ‹©
    arr_modified = np.select(conditions, choices, default=arr)
    print("ä¿®æ”¹åçš„æ•°ç»„:\n", arr_modified)
    
    ```

### ğŸš np.percentile

`np.percentile(arr, [25, 50, 75])`

è®¡ç®—æ•°ç»„çš„ç™¾åˆ†ä½æ•°ï¼Œç™¾åˆ†ä½æ•°æ˜¯ç»Ÿè®¡å­¦ä¸­ç”¨äºæè¿°æ•°æ®åˆ†å¸ƒçš„ä¸€ç§æ–¹æ³•ã€‚å®ƒè¡¨ç¤ºæ•°æ®é›†ä¸­æŸä¸ªç™¾åˆ†æ¯”çš„æ•°æ®ç‚¹æ‰€å¤„çš„ä½ç½®ï¼Œå¸®åŠ©è¯†åˆ«æ•°æ®çš„åˆ†å¸ƒå’Œå¼‚å¸¸å€¼ã€‚

å¸¸è§çš„ç™¾åˆ†ä½æ•°ï¼š

* ç¬¬25ç™¾åˆ†ä½æ•°ï¼Œä¹Ÿç§°ä¸ºç¬¬ä¸€å››åˆ†ä½æ•°ï¼ˆFirst Quartileï¼‰ã€‚è¡¨ç¤ºæ•°æ®é›†ä¸­è‡³å°‘æœ‰ 25% çš„æ•°æ®ç‚¹å°äºæˆ–ç­‰äºè¯¥å€¼ã€‚

* ç¬¬50ç™¾åˆ†ä½æ•°ï¼Œä¹Ÿç§°ä¸ºä¸­ä½æ•°ï¼ˆMedianï¼‰ã€‚è¡¨ç¤ºæ•°æ®é›†ä¸­è‡³å°‘æœ‰ 50% çš„æ•°æ®ç‚¹å°äºæˆ–ç­‰äºè¯¥å€¼ã€‚

* ç¬¬75ç™¾åˆ†ä½æ•°ï¼Œä¹Ÿç§°ä¸ºç¬¬ä¸‰å››åˆ†ä½æ•°ï¼ˆThird Quartileï¼‰ã€‚è¡¨ç¤ºæ•°æ®é›†ä¸­è‡³å°‘æœ‰ 75% çš„æ•°æ®ç‚¹å°äºæˆ–ç­‰äºè¯¥å€¼ã€‚

### ğŸš å‚…é‡Œå¶å˜æ¢

å°†ä¿¡å·ä»æ—¶åŸŸè½¬æ¢åˆ°é¢‘åŸŸï¼Œä¾¿äºåˆ†æä¿¡å·çš„é¢‘ç‡æˆåˆ†ã€‚

numpyä¸­ä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ (FFT): æ˜¯å‚…é‡Œå¶å˜æ¢çš„é«˜æ•ˆç®—æ³•ï¼Œèƒ½å¤Ÿæ˜¾è‘—å‡å°‘è®¡ç®—æ—¶é—´ã€‚

è§‚å¯Ÿé¢‘åŸŸä¿¡å·å›¾ï¼Œå³°å€¼å¯¹åº”çš„é¢‘ç‡é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¿¡å·çš„ä¸»å¯¼é¢‘ç‡ã€‚åœ¨é‡‘èé¢†åŸŸï¼Œè¿™äº›é¢‘ç‡å¯èƒ½å¯¹åº”äºä¸åŒçš„å¸‚åœºå‘¨æœŸæˆ–è¶‹åŠ¿ã€‚

ï¼ˆtodoï¼šå¦‚ä½•è¯†åˆ«å‘¨æœŸæˆ–è¶‹åŠ¿ï¼‰

```python
import numpy as np
import matplotlib.pyplot as plt

noise_signal = np.random.normal(0.0007, 0.025, 1000)

# åˆ›å»ºæ—¶é—´å‘é‡
t = np.linspace(0, 1, 1000, endpoint=False)

# å¿«é€Ÿå‚…é‡Œå¶å˜æ¢
fft_result = np.fft.fft(noise_signal)
frequencies = np.fft.fftfreq(noise_signal.size, d=t[1] - t[0])

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams['font.sans-serif'] = ['SimHei']  # ä½¿ç”¨é»‘ä½“
plt.rcParams['axes.unicode_minus'] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜

# ç»˜åˆ¶æ—¶åŸŸä¿¡å·
plt.figure(figsize=(12, 6))
plt.subplot(2, 1, 1)
plt.plot(t, noise_signal)
plt.title('æ—¶åŸŸä¿¡å·')
plt.xlabel('æ—¶é—´')
plt.ylabel('å¹…åº¦')

# ç»˜åˆ¶é¢‘åŸŸä¿¡å·
plt.subplot(2, 1, 2)
plt.plot(frequencies[:len(frequencies) // 2], np.abs(fft_result[:len(fft_result) // 2]))
plt.title('é¢‘åŸŸä¿¡å·')
plt.xlabel('é¢‘ç‡')
plt.ylabel('å¹…åº¦')
plt.xlim(0, 20)  # é™åˆ¶é¢‘ç‡èŒƒå›´ä»¥ä¾¿è§‚å¯Ÿ
plt.tight_layout()
plt.show()

```