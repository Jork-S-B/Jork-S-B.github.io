# æ€§èƒ½æµ‹è¯•

æ€§èƒ½æµ‹è¯•ï¼Œè¯„ä¼°ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„æµ‹è¯•ï¼Œä¸»è¦æŒ‡æ ‡æœ‰å“åº”æ—¶é—´ã€ååé‡ã€èµ„æºåˆ©ç”¨ç‡ç­‰ã€‚

* å‹åŠ›æµ‹è¯•ï¼Œåœ¨å¼ºè´Ÿè½½ï¼ˆå¤§æ•°æ®é‡ã€å¤§é‡å¹¶å‘ç”¨æˆ·ç­‰ï¼‰ä¸‹çš„æµ‹è¯•ã€‚
* è´Ÿè½½æµ‹è¯•ï¼Œåœ¨ä¸€å®šè´Ÿè½½æƒ…å†µä¸‹çš„ç³»ç»Ÿæ€§èƒ½æµ‹è¯•ï¼ˆä¸å…³æ³¨ç¨³å®šæ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…³æ³¨é•¿æ—¶é—´è¿è¡Œï¼Œåªæ˜¯å¾—åˆ°ä¸åŒè´Ÿè½½ä¸‹ç›¸å…³æ€§èƒ½æŒ‡æ ‡å³å¯ï¼‰ï¼Œå…³æ³¨è¢«æµ‹åº”ç”¨å¯ä»¥æ‰¿å—å¤šå°‘è´Ÿè½½ã€‚

---

## ğŸ“Œ ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•

1. ç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œå†…å®¹åŒ…æ‹¬çº¿ç¨‹æ•°8ã€ramp_up_timeå¯åŠ¨æ‰€æœ‰çº¿ç¨‹æ‰€éœ€æ—¶é—´ã€å¾ªç¯æ¬¡æ•°ã€æŒç»­æ—¶é—´300sã€å¯åŠ¨å»¶è¿Ÿæ—¶é—´ã€‚
2. ç™»å½•è¯·æ±‚çº¿ç¨‹ç»„ï¼Œæ­é…æ­£åˆ™è¡¨è¾¾å¼æå–å™¨ã€BeanShell PostProcessorå°†tokenè®¾ç½®ä¸ºå…¨å±€å˜é‡ã€‚
3. Httpè¯·æ±‚é»˜è®¤å€¼ï¼ŒåŒ…æ‹¬åè®®ã€ipã€ç«¯å£ã€ç¼–ç ã€‚
4. Httpä¿¡æ¯å¤´ç®¡ç†å™¨ï¼ŒåŒ…æ‹¬æŠ¥æ–‡ç±»å‹ã€tokenç­‰ä¿¡æ¯ã€‚
5. è¢«æµ‹è¯·æ±‚çº¿ç¨‹ç»„ï¼ŒåŒ…æ‹¬äº‹åŠ¡æ§åˆ¶å™¨ã€csvæ•°æ®æ–‡ä»¶ï¼ˆå‚æ•°åŒ–ï¼‰ã€è¯·æ±‚ã€æå–å™¨ã€å“åº”æ–­è¨€ã€æ–­è¨€ç»“æœã€æ±‡æ€»æŠ¥å‘Šã€‚
6. æ€»ä½“çš„ç»“æœæ ‘ã€æŠ¥å‘Šã€äº‹åŠ¡å“åº”æ—¶é—´å›¾
7. ç”ŸæˆhtmlæŠ¥å‘Šï¼Œå¹³å‡å“åº”æ—¶é—´200ms-1200ms

æ­¥éª¤å‚è€ƒ: [202409.jmx](performance/202409.jmx)

æ‰§è¡Œå‚è€ƒ: [run.sh](performance/run.sh)

å‚è€ƒèµ„æ–™: [JMeterå‹åŠ›æµ‹è¯•å®Œæ•´æµç¨‹](https://blog.csdn.net/m0_47747596/article/details/131658904)

=== "run.sh"
    
    ```shell
    #!/bin/bash
    current_datetime=$(date +%Y%m%d%H%M%S)
    mkdir -p "${current_datetime}"
    # touch "${current_datetime}/output.jtl"  # æ— éœ€å…ˆæ‰‹åŠ¨åˆ›å»º
    mkdir -p "${current_datetime}/results"
    jmeter -n -t 202409.jmx -l "${current_datetime}/output.jtl" -e -o "${current_datetime}/results"
    ```

### ğŸš ä»…ä¸€æ¬¡æ§åˆ¶å™¨

å½“éœ€è¦å°†å¤šä¸ªè¯·æ±‚ä¸€èµ·ç»Ÿè®¡æ—¶ä½¿ç”¨ã€‚

### ğŸš ååé‡æ§åˆ¶å™¨

é™åˆ¶æµé‡ï¼Œååé‡æ§åˆ¶å™¨-ååé‡è®¾ç½®ä¸º10.0ï¼Œè¡¨ç¤ºé™æµä¸º10%ã€‚

### ğŸš äº‹åŠ¡æ§åˆ¶å™¨

å½“éœ€è¦å°†å¤šä¸ªè¯·æ±‚ä¸€èµ·ç»Ÿè®¡æ—¶ä½¿ç”¨ã€‚

### ğŸš åç½®å¤„ç†å™¨

* è¾¹ç•Œæå–å™¨ï¼Œè¾“å…¥å·¦è¾¹ç•Œ/å³è¾¹ç•Œï¼Œæå–è¾¹ç•Œé‡Œçš„æ•°æ®ã€‚
* å…¶ä»–çš„è¿˜æœ‰jsonæå–å™¨ã€æ­£åˆ™æå–å™¨ã€xpathæå–å™¨ç­‰ã€‚

### ğŸš å¹¶å‘

åŒæ­¥å®šæ—¶å™¨ï¼Œç­‰å¾…çº¿ç¨‹æ•°åˆ°é¢„è®¾æ•°é‡åè§¦å‘äº‹åŠ¡ï¼Œè¾¾åˆ°é›†åˆç‚¹çš„ä½œç”¨ã€‚

å‚è€ƒèµ„æ–™: [åŒæ­¥å®šæ—¶å™¨](https://zhuanlan.zhihu.com/p/594119162?utm_id=0)

### ğŸš æ–­è¨€

* å“åº”æ–­è¨€ï¼Œå¯ä»¥é…ç½®åŒ¹é…å“åº”æ–‡æœ¬ã€è¯·æ±‚å¤´ã€å“åº”å¤´ç­‰ï¼Œæˆ–è€…è®¾ç½®åŒ…æ‹¬ã€ç›¸ç­‰ç­‰è§„åˆ™
* æ•°æ®åŒ…å­—èŠ‚å¤§å°æ–­è¨€
* æŒç»­æ—¶é—´æ–­è¨€ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´å†…è¿”å›å“åº”ç»“æœ
* beanshellæ–­è¨€

[å…¶ä»–åŠŸèƒ½è¡¥å……](../utils/jmeter_notes.md)

## ğŸ“Œ å‹æµ‹éœ€è¦å…³æ³¨çš„æŒ‡æ ‡

ååé‡ã€å“åº”æ—¶é—´å’Œç”¨æˆ·æ•°é‡: åˆšå¼€å§‹ååé‡éšç€ç”¨æˆ·æ•°é‡çš„å¢åŠ é€æ¸å˜å¤§ï¼Œå½“è¾¾åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œé€æ¸å¹³ç¼“ç›´åˆ°å˜æˆä¸€æ¡å¹³çº¿ï¼›è€Œå“åº”æ—¶é—´éšç€ç”¨æˆ·æ•°é‡çš„å¢é•¿é€æ¸å˜å¤§ã€‚

å…³æ³¨çš„æŒ‡æ ‡: å¹¶å‘æ•°ã€å“åº”æ—¶é—´ã€TPS-æ¯ç§’å¤„ç†äº‹åŠ¡æ•°ã€QPS-æ¯ç§’å¤„ç†æŸ¥è¯¢æ•°ã€æœåŠ¡å™¨èµ„æºã€‚

ğŸ¬ åœºæ™¯: å¹¶å‘æ•°å¤ªé«˜ï¼Œååé‡å°ï¼Œå½±å“å¾—åˆ°çš„å“åº”æ—¶é—´å‡†ç¡®æ€§ã€‚

éœ€è¦ä»å°å¹¶å‘å¾€ä¸Šé€’å¢åŠ å‹ï¼ŒTPSéšä¹‹å¾€ä¸Šå¢é•¿ï¼›å½“TPSä¸æ¶¨æ—¶ï¼Œæ­¤æ—¶çš„å¹¶å‘æ•°å°±æ˜¯æœ€ä½³å¹¶å‘æ•°ã€‚

---

è€Œå½“åœ¨æœ€ä½³å¹¶å‘æ•°ä¸‹å‡ºç°å“åº”æ—¶é—´è¿‡é•¿çš„æƒ…å†µæ—¶:

ğŸ¤” åˆ†æåŸå› :

* ç½‘ç»œå»¶è¿Ÿ: æ£€æŸ¥ç½‘ç»œçŠ¶å†µï¼Œç¡®ä¿ç½‘ç»œå¸¦å®½å’Œç¨³å®šæ€§æ»¡è¶³æµ‹è¯•éœ€æ±‚ã€‚ï¼ˆå±€åŸŸç½‘ä¸€èˆ¬å½±å“ä¸å¤§ï¼‰

* æœåŠ¡å™¨æ€§èƒ½: æ£€æŸ¥æœåŠ¡å™¨CPUã€å†…å­˜ç­‰èµ„æºä½¿ç”¨æƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦ç”±äºèµ„æºä¸è¶³å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚

* æ¥å£è®¾è®¡: æ£€æŸ¥æ¥å£æ˜¯å¦æ¶‰åŠå¤æ‚è®¡ç®—æˆ–å¤§é‡æ•°æ®å¤„ç†ï¼Œè¿™äº›æ“ä½œå¯èƒ½å¯¼è‡´å“åº”æ—¶é—´å»¶é•¿ã€‚

* ä»£ç ä¼˜åŒ–: åˆ†æä»£ç å®ç°ï¼Œçœ‹æ˜¯å¦å­˜åœ¨å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œå¦‚å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ã€ä½¿ç”¨ç¼“å­˜ç­‰ã€‚

ğŸ” å¤„ç†æ–¹æ³•:

* ä¼˜åŒ–ç½‘ç»œ: å¦‚æœç½‘ç»œå»¶è¿Ÿæ˜¯ä¸»è¦åŸå› ï¼Œå¯ä»¥å°è¯•å‡çº§ç½‘ç»œè®¾å¤‡ã€ä¼˜åŒ–ç½‘ç»œé…ç½®æˆ–é€‰æ‹©æ›´ç¨³å®šçš„ç½‘ç»œç¯å¢ƒè¿›è¡Œæµ‹è¯•ã€‚

* å‡çº§æœåŠ¡å™¨: å¦‚æœæœåŠ¡å™¨æ€§èƒ½ä¸è¶³ï¼Œå¯ä»¥è€ƒè™‘å‡çº§æœåŠ¡å™¨ç¡¬ä»¶æˆ–å¢åŠ æœåŠ¡å™¨æ•°é‡æ¥æé«˜å¤„ç†èƒ½åŠ›ã€‚

* ä¼˜åŒ–æ¥å£è®¾è®¡: å¯¹äºæ¶‰åŠå¤æ‚è®¡ç®—æˆ–å¤§é‡æ•°æ®å¤„ç†çš„æ¥å£ï¼Œå¯ä»¥å°è¯•ä¼˜åŒ–ç®—æ³•ã€å‡å°‘æ•°æ®å¤„ç†é‡æˆ–é‡‡ç”¨å¼‚æ­¥å¤„ç†æ–¹å¼æ¥æé«˜å“åº”é€Ÿåº¦ã€‚

* ä¼˜åŒ–ä»£ç : å¯¹ä»£ç è¿›è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆå¹¶è¿›è¡Œä¼˜åŒ–ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´é«˜æ•ˆçš„ç®—æ³•ã€å‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ã€ä½¿ç”¨ç¼“å­˜ç­‰æŠ€æœ¯æ¥æé«˜å“åº”é€Ÿåº¦ã€‚

* å¼•å…¥ç¼“å­˜æœºåˆ¶: å¯¹äºç»å¸¸è®¿é—®çš„æ•°æ®æˆ–è®¡ç®—ç»“æœï¼Œå¯ä»¥å°†å…¶ç¼“å­˜åœ¨å†…å­˜æˆ–ç¼“å­˜æ•°æ®åº“ä¸­ï¼Œä»¥å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚

* ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜: å°†ç»å¸¸è®¿é—®çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œä»¥å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Œæé«˜æ¥å£çš„å“åº”é€Ÿåº¦ã€‚

## ğŸ“Œ åˆ†å¸ƒå¼é›†ç¾¤å‹æµ‹

å•å°å‹åŠ›æœºï¼Œèµ„æºä¸è¶³ä»¥è§¦å‘è¶³å¤Ÿå¤šçš„å¹¶å‘æ—¶ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼å‹æµ‹ã€‚

1.é…ç½®æ§åˆ¶æœºçš„jmeter/bin/jmeter.properties

* æœç´¢: `server.rmi.ssl.disable`ï¼Œè®¾ç½®ä¸ºtrueï¼Œä¸ä½¿ç”¨åŠ å¯†è®¤è¯ä¼ è¾“ã€‚
* æœç´¢: `remote_hosts`ï¼Œè®¾ç½®å‹åŠ›æœºçš„ipåŠç«¯å£ï¼Œé€—å·åˆ†éš”ã€‚
* æœç´¢: `mode=Standard`ï¼Œå»æ‰æ³¨é‡Šï¼Œç”¨äºå›¾å½¢ç•Œé¢çœ‹ç»“æœã€‚

2.æ‰“åŒ…jmeterç›®å½•åŠjmxè„šæœ¬ï¼Œä¸Šä¼ åˆ°å‹åŠ›æœºï¼Œç¡®ä¿ç‰ˆæœ¬ã€é…ç½®ã€è„šæœ¬ç­‰ä¸€è‡´ã€‚

3.é…ç½®å‹åŠ›æœºçš„jmeter/bin/jmeter.properties

* æœç´¢: `remote_hosts`ï¼Œè®¾ç½®ä¸º`127.0.0.1`ã€‚
* æœç´¢: `server_prot`ï¼Œè®¾ç½®æ§åˆ¶æœºçš„ç«¯å£ã€‚
* å…³é—­é˜²ç«å¢™: `systemctl stop firewalld.service`
* è®¾ç½®å¯æ‰§è¡Œæƒé™: `chmod 777 jmeter/bin`
* å¯åŠ¨å‹åŠ›æœºæœåŠ¡: `jmter-server -Djava.rmi.server.hostname={ip}`
å‰æ: æ‰§è¡Œæœºå·²å®‰è£…JDK

4.æ§åˆ¶æœºå›¾å½¢åŒ–ç•Œé¢è¿œç¨‹å¯åŠ¨  
è¿è¡Œ->è¿œç¨‹å¯åŠ¨->é€‰æ‹©å‹åŠ›æœº  
æˆ–è€…é€šè¿‡å‘½ä»¤å¯åŠ¨: `jmeter -n -t 202409.jmx -l "${current_datetime}/output.jtl" -e -o "${current_datetime}/results" -r`

## ğŸ“Œ ç›‘æ§è¿è¡Œç»“æœ

### ğŸš Grafana: å¯è§†åŒ–çš„å›¾å½¢å±•ç¤ºå¹³å°ï¼Œæä¾›äº†è¾ƒå¤šæ¨¡æ¿ï¼Œè‡ªåŠ¨æ”¶é›†æœåŠ¡å™¨èµ„æºã€‚

1.å®‰è£…: `sudo yum install -y https://dl.grafana.com/oss/release/grafana-10.0.3-1.x86_64.rpm`

2.å¯åŠ¨æœåŠ¡: `systemctl start grafana-server`  
å…³é—­é˜²ç«å¢™: `systemctl stop firewalld.service`

3.è®¿é—®: ip:{é»˜è®¤ç«¯å£3000}  
é»˜è®¤ç”¨æˆ·åå¯†ç : admin/admin

### ğŸš Influxdb: æ—¶åºæ•°æ®åº“

1.å®‰è£…: `sudo yum install -y`ï¼Œå…·ä½“è·¯å¾„å¾…è¡¥å……

2.åå°è¿è¡ŒæœåŠ¡: `influxd &`

3.è¿›å…¥æ•°æ®åº“: `influx`  

```sql
CREATE DATABASE jmeter;
show databases;
use jmeter;
show measurements;  # ç±»ä¼¼show tables
```

### ğŸš ä½¿ç”¨åç«¯ç›‘å¬å™¨å°†æ‰§è¡Œæ•°æ®å†™å…¥Influxdb

---




