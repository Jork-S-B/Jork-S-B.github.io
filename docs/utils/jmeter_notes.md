## ğŸ“Œ ä½¿ç”¨JMeterè¿›è¡Œå‹åŠ›æµ‹è¯•

1. ç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œå†…å®¹åŒ…æ‹¬çº¿ç¨‹æ•°8ã€ramp_up_timeå¯åŠ¨æ‰€æœ‰çº¿ç¨‹æ‰€éœ€æ—¶é—´ã€å¾ªç¯æ¬¡æ•°-æ°¸è¿œã€æŒç»­æ—¶é—´300sã€å¯åŠ¨å»¶è¿Ÿæ—¶é—´ã€‚
2. ç™»å½•è¯·æ±‚çº¿ç¨‹ç»„ï¼Œæ­é…æ­£åˆ™è¡¨è¾¾å¼æå–å™¨ã€BeanShell PostProcessorå°†tokenè®¾ç½®ä¸ºå…¨å±€å˜é‡ã€‚
3. Httpè¯·æ±‚é»˜è®¤å€¼ï¼ŒåŒ…æ‹¬åè®®ã€ipã€ç«¯å£ã€ç¼–ç ã€‚
4. Httpä¿¡æ¯å¤´ç®¡ç†å™¨ï¼ŒåŒ…æ‹¬æŠ¥æ–‡ç±»å‹ã€tokenç­‰ä¿¡æ¯ã€‚
5. è¢«æµ‹è¯·æ±‚çº¿ç¨‹ç»„ï¼ŒåŒ…æ‹¬äº‹åŠ¡æ§åˆ¶å™¨ã€csvæ•°æ®æ–‡ä»¶ï¼ˆå‚æ•°åŒ–ï¼‰ã€è¯·æ±‚ã€æå–å™¨ã€å“åº”æ–­è¨€ã€æ–­è¨€ç»“æœã€æ±‡æ€»æŠ¥å‘Šã€‚
6. æ€»ä½“çš„ç»“æœæ ‘ã€æŠ¥å‘Šã€äº‹åŠ¡å“åº”æ—¶é—´å›¾
7. ç”ŸæˆhtmlæŠ¥å‘Šï¼Œå¹³å‡å“åº”æ—¶é—´200ms-1200ms

æ­¥éª¤å‚è€ƒ: [202409.jmx](performance/202409.jmx)

æ‰§è¡Œå‚è€ƒ: [run.sh](performance/run.sh)

å‚è€ƒèµ„æ–™: [JMeterå‹åŠ›æµ‹è¯•å®Œæ•´æµç¨‹](https://blog.csdn.net/m0_47747596/article/details/131658904)

=== "run.sh"
    
    ```shell
    #!/bin/bash
    current_datetime=$(date +%Y%m%d%H%M%S)
    mkdir -p "${current_datetime}"
    # touch "${current_datetime}/output.jtl"  # æ— éœ€å…ˆæ‰‹åŠ¨åˆ›å»º
    mkdir -p "${current_datetime}/results"
    jmeter -n -t 202409.jmx -l "${current_datetime}/output.jtl" -e -o "${current_datetime}/results"
    ```

### ğŸš ä»…ä¸€æ¬¡æ§åˆ¶å™¨

æ§åˆ¶ä»…ä½¿ç”¨ä¸€æ¬¡çš„è¯·æ±‚

### ğŸš ååé‡æ§åˆ¶å™¨

é™åˆ¶æµé‡ï¼Œååé‡æ§åˆ¶å™¨-ååé‡è®¾ç½®ä¸º10.0ï¼Œè¡¨ç¤ºé™æµä¸º10%ã€‚

### ğŸš äº‹åŠ¡æ§åˆ¶å™¨

å½“éœ€è¦å°†å¤šä¸ªè¯·æ±‚ä¸€èµ·ç»Ÿè®¡æ—¶ä½¿ç”¨ã€‚

### ğŸš åç½®å¤„ç†å™¨

* è¾¹ç•Œæå–å™¨ï¼Œè¾“å…¥å·¦è¾¹ç•Œ/å³è¾¹ç•Œï¼Œæå–è¾¹ç•Œé‡Œçš„æ•°æ®ã€‚
* å…¶ä»–çš„è¿˜æœ‰jsonæå–å™¨ã€æ­£åˆ™æå–å™¨ã€xpathæå–å™¨ç­‰ã€‚

### ğŸš å¹¶å‘

åŒæ­¥å®šæ—¶å™¨ï¼Œç­‰å¾…çº¿ç¨‹æ•°åˆ°é¢„è®¾æ•°é‡åè§¦å‘äº‹åŠ¡ï¼Œè¾¾åˆ°é›†åˆç‚¹çš„ä½œç”¨ã€‚åº”ç”¨åœºæ™¯å¦‚ç”µå•†ç§’æ€ã€‚

å‚æ•°éƒ½è®¾ç½®ä¸º0æ—¶ï¼Œä»£è¡¨ç­‰åˆ°çº¿ç¨‹ç»„æ‰€æœ‰ç”¨æˆ·ä¸€èµ·å¹¶å‘ã€‚

å‚è€ƒèµ„æ–™: [åŒæ­¥å®šæ—¶å™¨](https://zhuanlan.zhihu.com/p/594119162?utm_id=0)

### ğŸš æ–­è¨€

* å“åº”æ–­è¨€ï¼Œå¯ä»¥é…ç½®åŒ¹é…å“åº”æ–‡æœ¬ã€è¯·æ±‚å¤´ã€å“åº”å¤´ç­‰ï¼Œæˆ–è€…è®¾ç½®åŒ…æ‹¬ã€ç›¸ç­‰ç­‰è§„åˆ™
* æ•°æ®åŒ…å­—èŠ‚å¤§å°æ–­è¨€
* æŒç»­æ—¶é—´æ–­è¨€ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´å†…è¿”å›å“åº”ç»“æœ
* beanshellæ–­è¨€

## ğŸ“Œ é€ ä»¿çœŸæ•°æ®

1. å³å‡»çº¿ç¨‹ç»„->æ·»åŠ å–æ ·å™¨->OSè¿›ç¨‹å–æ ·å™¨ï¼Œå¹¶è¿›è¡Œé…ç½®
2. æ·»åŠ åç½®å¤„ç†å™¨->JSONæå–å™¨ï¼Œå¹¶è¿›è¡Œé…ç½®
3. åœ¨è¯·æ±‚æŠ¥æ–‡ä¸­ä½¿ç”¨æå–å‡ºæ¥çš„å˜é‡ï¼Œæ ¼å¼ä¸º`${å˜é‡å}`

=== "demo.py"

    ```python
    import json
    from faker import Faker
    from faker.providers import BaseProvider
    
    
    # è‡ªå®šä¹‰æ•°æ®
    class CustomFaker(BaseProvider):
        def prodid(self):
            # å‡è®¾æ˜¯ä»åº“è¡¨æˆ–æ¥å£è·å–åˆ°çš„è®¢è´­äº§å“id
            prod_list = ["prodid1", "prodid2", "prodid3"]
            return self.random_element(prod_list)
    
    
    faker = Faker(locale='zh_CN')
    faker.add_provider(CustomFaker)
    result = {
        "id_num": faker.ssn(),
        "name": faker.name(),
        "phone": faker.phone_number(),
        "email": faker.email(),
        "address": faker.address(),
        "birthday": faker.date_of_birth().strftime("%Y-%m-%d"),
        "prodid": faker.prodid()
    }
    
    # print(json.dumps(result,ensure_ascii=False))  # JMeterä¸­æ‰§è¡Œpythonåè€Œè¿™ä¸€è¡Œç»“æœä¹±ç 
    print(json.dumps(result))

    ```

=== "OSè¿›ç¨‹å–æ ·å™¨é…ç½®ç¤ºä¾‹"

    ![img.png](image/Snipaste_2024-06-15_23-42-26.jpg)

=== "JSONæå–å™¨é…ç½®ç¤ºä¾‹"

    ![img.png](image/Snipaste_2024-06-15_23-50-54.jpg)

=== "æŠ¥æ–‡ä¸­ä½¿ç”¨å˜é‡ç¤ºä¾‹"

    ```json
    {
        "name":"${name}",
        "id_num":"${id_num}",
        "phone":"${phone}"
    }
    
    ```

## ğŸ“Œ å“åº”æŠ¥æ–‡çš„æ±‰å­—ä¹±ç 

è§£å†³æ–¹æ¡ˆ:

1. æ‰“å¼€JMeterç›®å½•çš„`bin/jmeter.properties`æ–‡ä»¶
2. æœç´¢å…³é”®å­—: `sampleresult.default.encoding`
3. å»æ‰æ³¨é‡Šç¬¦ï¼Œä¿®æ”¹ç¼–ç ä¸ºUTF-8ï¼Œå³`sampleresult.default.encoding=UTF-8`
4. é‡å¯JMeter

JMeter 5.6.1 ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤UTF-8ç¼–ç ï¼Œæ— éœ€ä¿®æ”¹ã€‚

å…¶ä»–è§£å†³æ–¹æ¡ˆå‚è€ƒ: [è§£å†³Jmeterå“åº”æŠ¥æ–‡ä¸­æ–‡ä¹±ç çš„é—®é¢˜-3ç§è§£å†³åŠæ³•](https://blog.csdn.net/u013302168/article/details/126366082ï»¿)

## ğŸ“Œ ä½¿ç”¨æ’ä»¶

1. ä¸‹è½½æ’ä»¶: https://jmeter-plugins.org/downloads/old/
2. è§£å‹åæŠŠ`lib`æ–‡ä»¶å¤¹æ‰”åˆ°JMeterç›®å½•ï¼Œé‡å¯JMeterã€‚ä¹‹åä¾¿å¯ä½¿ç”¨é˜¶æ¢¯åŠ å‹çº¿ç¨‹ç»„ã€å“åº”æ—¶é—´æŠ˜çº¿å›¾ã€TPSæŠ˜çº¿å›¾ç­‰ç»„ä»¶ã€‚

### ğŸš mysqlæ•°æ®åº“å‹æµ‹

1.æŸ¥mysqlç‰ˆæœ¬å·: `mysql --version`

æˆ–è€…è¿ä¸Šmysqlå`select version();`

2.é…ç½®ç«¯å£ï¼ˆé»˜è®¤3306ï¼‰ï¼Œé‡å¯æœåŠ¡`systemctl restart mysqld`


=== "/etc/my.cnf"

    ```text
    [mysqld]
    port=3306
    ```

=== "jdbc.properties"

    ```text
    mysqlbase.port=3309
    ```

3.è„šæœ¬è®¾è®¡

[ä¸‹è½½æ’ä»¶](https://downloads.mysql.com/archives/c-j/)ï¼Œè§£å‹åæŠŠjaræ”¾åˆ°jMmeter/lib/extç›®å½•ã€‚

JMeterä¸­æ·»åŠ ï¼š

* å–æ ·å™¨ -> `JDBC Request`ï¼ŒQueryä¸»è¦åŒ…æ‹¬æ ¸å¿ƒä¸šåŠ¡çš„SQLè¯­å¥ã€‚
* é…ç½®å…ƒä»¶ -> `JDBC Connection Configuration`ï¼Œå¡«å†™é…ç½®åŒ…æ‹¬JDBC Driver classã€Database URL(jdbc:mysql://ip:ç«¯å£/åº“å)ã€ç”¨æˆ·åã€å¯†ç ã€è¿æ¥æ± (è·Ÿå–æ ·å™¨çš„è¿æ¥æ± å˜é‡åä¿æŒä¸€è‡´)ã€‚

è¿æ¥æ± çš„ä½œç”¨: é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„ã€ä¿æŒæ´»è·ƒçš„è¿æ¥ä¾›è¯·æ±‚å¤ç”¨ï¼Œé¿å…é¢‘ç¹åœ°å»ºç«‹å’Œå…³é—­è¿æ¥æ‰€å¸¦æ¥çš„å»¶è¿Ÿã€‚  
è¿™é‡Œç”¨äºæ¨¡æ‹Ÿå¤šçº¿ç¨‹é«˜å¹¶å‘è®¿é—®çš„åœºæ™¯ã€‚

## ğŸ“Œ ä½¿ç”¨ä»£ç†æœåŠ¡å™¨å½•åˆ¶è„šæœ¬

å‚è€ƒèµ„æ–™: [jmeterä»£ç†æœåŠ¡å™¨å½•åˆ¶è„šæœ¬æ•™ç¨‹ï¼ˆå…¥é—¨ç¯‡ï¼‰](https://blog.csdn.net/weixin_42614544/article/details/109514086)

## ğŸ“Œ ä½¿ç”¨è‡ªå¸¦å‡½æ•°

å·¥å…· -> å‡½æ•°åŠ©æ‰‹å¯¹è¯æ¡†ï¼Œæ‰¾éœ€è¦ç”¨çš„å‡½æ•°è°ƒè¯•ã€‚

=== "éšæœºæ•°ç¤ºä¾‹"

    ```json
    {
        "id":"${__Random(100,105)}",  // ä»100è‡³105çš„åºåˆ—ä¸­éšæœºå–æ•°
        "phone":"${__chooseRandom(1.0.1,1.0.2,1.0.3)}"  // ä»è¯¥åˆ—è¡¨ä¸­éšæœºå–æ•°
    }
    ```

=== "åŠ å¯†ç¤ºä¾‹"

    ```json
    {
        "passwprd": ${__digest(md5,${pass},,,)}  // å®‰è£…æ’ä»¶çš„è¯å¯ä»¥ç›´æ¥ä½¿ç”¨md5()
    }
    ```

## ğŸ“Œ è°ƒå¤–éƒ¨jaråŒ…æ–¹æ³•

1. jaråŒ…éœ€è¦æ”¾JMeterç›®å½•çš„`lib\ext`ç›®å½•ä¸‹
2. jaråŒ…é‡Œè°ƒç”¨çš„ç¬¬ä¸‰æ–¹jaråŒ…ä¹Ÿè¦æ”¾åˆ°`lib`å’Œ`lib/ext`é‡Œ
3. è®°å¾—é‡å¯JMeterï¼Œæ·»åŠ å‰ç½®å¤„ç†å™¨: BeanShell PreProcessorï¼Œç„¶åå†™è„šæœ¬

=== "BeanShell PreProcessor"

    ```java
    import xx.Util;
    
    String sp = "18" + Integer.toString(${__Random(000000000,999999999,)});
    log.info("phonenum is" + sp);
    vars.put("phone",sp);
    String code = Util.encrypt(sp);
    
    // å­˜å…¥å˜é‡ï¼Œåœ¨è„šæœ¬æ–‡æœ¬ä¸­é€šè¿‡${phone}å¼•ç”¨ï¼Œä¸èƒ½è·¨çº¿ç¨‹
    vars.put("phone",code);

    // è®°å½•æ—¥å¿—
    log.info("phonenum is" + vars.get("phone"));

    // propsèƒ½è·¨çº¿ç¨‹ï¼Œæ˜¯hashtableå¯¹è±¡
    props.put("phone",code);  // åœ¨è„šæœ¬æ–‡æœ¬ä¸­é€šè¿‡${__P(phone)}å¼•ç”¨
    ```

å‚è€ƒèµ„æ–™: [jmeterå¼•ç”¨jaråŒ…çš„3ç§æ–¹å¼](https://www.cnblogs.com/uncleyong/p/11475577.html)

## ğŸ“Œ æŠ¥å‘Šåˆ†æ

å‚è€ƒèµ„æ–™:

https://blog.csdn.net/m0_61066945/article/details/136062323

https://blog.csdn.net/qq_24394093/article/details/90732577

* éªŒè¯æœ€å¤§å¹¶å‘ç”¨æˆ·æ•°
* é”™è¯¯ç‡-ä¸è¶…è¿‡0.2%
* å“åº”æ—¶é—´-ä¸è¶…è¿‡3ç§’
* GCé¢‘ç‡ä¸èƒ½è¿‡é«˜ï¼Œå½±å“æ€§èƒ½ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå‡ å¤©æˆ–å‡ å‘¨å‘ç”Ÿä¸€æ¬¡ã€‚
* æœåŠ¡å™¨èµ„æºï¼ŒCPUã€å†…å­˜ä½¿ç”¨ç‡å°äº80%

## ğŸ“Œ åˆ†å¸ƒå¼é›†ç¾¤å‹æµ‹

å•å°å‹åŠ›æœºï¼Œèµ„æºä¸è¶³ä»¥è§¦å‘è¶³å¤Ÿå¤šçš„å¹¶å‘æ—¶ï¼Œé‡‡ç”¨åˆ†å¸ƒå¼å‹æµ‹ã€‚

1.é…ç½®æ§åˆ¶æœºçš„jmeter/bin/jmeter.properties

* æœç´¢: `server.rmi.ssl.disable`ï¼Œè®¾ç½®ä¸ºtrueï¼Œä¸ä½¿ç”¨åŠ å¯†è®¤è¯ä¼ è¾“ã€‚
* æœç´¢: `remote_hosts`ï¼Œè®¾ç½®å‹åŠ›æœºçš„ipåŠç«¯å£ï¼Œé€—å·åˆ†éš”ã€‚
* æœç´¢: `mode=Standard`ï¼Œå»æ‰æ³¨é‡Šï¼Œç”¨äºå›¾å½¢ç•Œé¢çœ‹ç»“æœã€‚

2.æ‰“åŒ…jmeterç›®å½•åŠjmxè„šæœ¬ï¼Œä¸Šä¼ åˆ°å‹åŠ›æœºï¼Œç¡®ä¿ç‰ˆæœ¬ã€é…ç½®ã€è„šæœ¬ç­‰ä¸€è‡´ã€‚

3.é…ç½®å‹åŠ›æœºçš„jmeter/bin/jmeter.properties

* æœç´¢: `remote_hosts`ï¼Œè®¾ç½®ä¸º`127.0.0.1`ã€‚
* æœç´¢: `server_prot`ï¼Œè®¾ç½®æ§åˆ¶æœºçš„ç«¯å£ã€‚
* å…³é—­é˜²ç«å¢™: `systemctl stop firewalld.service`
* è®¾ç½®å¯æ‰§è¡Œæƒé™: `chmod 777 jmeter/bin`
* å¯åŠ¨å‹åŠ›æœºæœåŠ¡: `jmter-server -Djava.rmi.server.hostname={ip}`
å‰æ: æ‰§è¡Œæœºå·²å®‰è£…JDK

4.æ§åˆ¶æœºå›¾å½¢åŒ–ç•Œé¢è¿œç¨‹å¯åŠ¨  
è¿è¡Œ->è¿œç¨‹å¯åŠ¨->é€‰æ‹©å‹åŠ›æœº  
æˆ–è€…é€šè¿‡å‘½ä»¤å¯åŠ¨: `jmeter -n -t 202409.jmx -l "${current_datetime}/output.jtl" -e -o "${current_datetime}/results" -r`
